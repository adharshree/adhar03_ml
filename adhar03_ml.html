<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Classification with MobileNet (ml5.js)</title>

  <!-- p5.js (often used with ml5, safe to include) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/p5.min.js"></script>
  <!-- ml5.js -->
  <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f7fb;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .container {
      max-width: 900px;
      width: 100%;
      background: #ffffff;
      margin: 30px;
      padding: 20px 30px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 18px rgba(0,0,0,0.08);
    }

    h1 {
      margin-top: 0;
      font-size: 28px;
    }

    h2 {
      margin-top: 5px;
      color: #555;
      font-size: 18px;
      font-weight: normal;
    }

    .upload-section {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      border: 1px dashed #bbb;
      background: #fafbff;
    }

    .upload-section input[type="file"] {
      margin-top: 10px;
    }

    #preview-wrapper {
      margin-top: 20px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      align-items: flex-start;
    }

    #image {
      max-width: 350px;
      max-height: 260px;
      border-radius: 8px;
      border: 1px solid #ddd;
      object-fit: contain;
      background: #f0f0f0;
    }

    .button {
      margin-top: 15px;
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      background: #3f51b5;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }

    .button:disabled {
      background: #9fa8da;
      cursor: not-allowed;
    }

    #status {
      margin-top: 10px;
      font-size: 14px;
      color: #333;
    }

    .results-card {
      flex: 1;
      min-width: 250px;
      padding: 15px;
      border-radius: 8px;
      background: #f7f9ff;
      border: 1px solid #dde3ff;
    }

    .result-item {
      margin-bottom: 8px;
    }

    .result-label {
      font-weight: bold;
    }

    .result-confidence {
      color: #444;
      font-size: 14px;
    }

    .footer {
      margin-top: 25px;
      font-size: 13px;
      color: #777;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Image Classification</h1>
    <h2>Using MobileNet &amp; ml5.js (Browser-based Deep Learning)</h2>

    <div class="upload-section">
      <p><strong>Step 1:</strong> Choose an image from your computer.</p>
      <input type="file" id="imageUpload" accept="image/*">
      <br>
      <button class="button" id="classifyBtn" disabled>Classify Image</button>
      <div id="status">Model loading... please wait.</div>
    </div>

    <div id="preview-wrapper">
      <img id="image" alt="Selected preview will appear here">
      <div class="results-card">
        <h3>Predictions</h3>
        <div id="results">
          No predictions yet. Upload an image and click <b>Classify Image</b>.
        </div>
      </div>
    </div>

    <div class="footer">
      <strong>How it works:</strong> This web app loads a pre-trained MobileNet model (via ml5.js)
      directly in the browser. The model analyzes the uploaded image and predicts the most likely
      object along with confidence scores.
    </div>
  </div>

  <script>
    let classifier;         // will hold the loaded MobileNet model
    let modelReady = false; // flag to check if model is loaded
    let imageLoaded = false; // flag to check if user selected an image

    const statusEl = document.getElementById('status');
    const imageEl = document.getElementById('image');
    const resultsEl = document.getElementById('results');
    const classifyBtn = document.getElementById('classifyBtn');
    const imageUploadInput = document.getElementById('imageUpload');

    // 1. Load the MobileNet model when the page loads
    async function loadModel() {
      try {
        statusEl.textContent = 'Loading MobileNet model...';
        classifier = await ml5.imageClassifier('MobileNet');
        modelReady = true;
        statusEl.textContent = 'Model loaded ✅. Now choose an image.';
        // Enable button only when both model and image are ready
        updateButtonState();
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Error loading model: ' + err;
      }
    }

    // 2. When user selects an image
    imageUploadInput.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        imageEl.src = e.target.result; // Set image preview
      };
      reader.readAsDataURL(file);

      // Wait until image fully loads in the <img> element
      imageEl.onload = function() {
        imageLoaded = true;
        statusEl.textContent = 'Image loaded ✅. Click "Classify Image".';
        updateButtonState();
      };
    });

    // 3. Enable/disable button depending on readiness
    function updateButtonState() {
      classifyBtn.disabled = !(modelReady && imageLoaded);
    }

    // 4. When "Classify Image" button is clicked
    classifyBtn.addEventListener('click', async function() {
      if (!modelReady || !imageLoaded) return;

      statusEl.textContent = 'Classifying image...';
      resultsEl.innerHTML = 'Processing...';

      try {
        // classify() also returns a Promise
        const results = await classifier.classify(imageEl);

        // results is an array of predictions (sorted by confidence)
        // Show top 3 predictions
        let html = '';
        const topK = Math.min(3, results.length);
        for (let i = 0; i < topK; i++) {
          const label = results[i].label;
          const confidence = (results[i].confidence * 100).toFixed(2);
          html += `
            <div class="result-item">
              <div class="result-label">${i + 1}. ${label}</div>
              <div class="result-confidence">Confidence: ${confidence}%</div>
            </div>
          `;
        }

        resultsEl.innerHTML = html;
        statusEl.textContent = 'Classification complete ✅';
      } catch (error) {
        console.error(error);
        resultsEl.innerHTML = 'Error during classification: ' + error;
        statusEl.textContent = 'Failed to classify image.';
      }
    });

    // Start loading the model immediately
    loadModel();
  </script>
</body>
</html>﻿
   
